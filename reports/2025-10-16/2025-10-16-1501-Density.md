# Fredericton Marathon â€” Density Report
**Schema:** 1.0.0
**Method:** segments_from_bins
**Date:** 2025-10-16 15:01:46
**Inputs:** bins.parquet, segments.parquet, segment_windows_from_bins.parquet
**App:** v1.6.42

---

## Executive Summary
- **Peak Density:** 1.6340 p/mÂ² (LOS F)
- **Peak Rate:** 472.74 p/m/min
- **Segments with Flags:** 18 / 22
- **Flagged Bins:** 1342 / 8800
- **Operational Status:** ðŸ”´ Action Required (Critical density/rate conditions detected)

> Note: LOS = comfort index; operational flags reflect throughput surges even under LOS A/B.

---

## Methodology & Inputs
- **Window Size:** 30 s; **Bin Size:** 0.2 km
- LOS & Rate triggers per `density_rulebook.yml`.
- Data read from Parquet sources only.

---

## Start Times & Cohorts
Full: 07:00 | 10K: 07:20 | Half: 07:40
Bins may contain multiple event cohorts simultaneously.

---

## Course Overview

| Segment | Label | Type | Width (m) | Bins | Windows Active |
|----------|--------|-------|-----------|-------|----------------|
| A1 | Start to Queen/Regent | start_corral | 5.0 | 5 | 80 |
| A2 | Queen/Regent to WSB mid-point | on_course_open | 5.0 | 5 | 80 |
| A3 | WSB mid-point to Friel | on_course_open | 5.0 | 5 | 80 |
| B1 | Friel to 10K Turn | on_course_narrow | 1.5 | 5 | 80 |
| B2 | 10K Turn to Friel | on_course_narrow | 1.5 | 5 | 80 |
| B3 | 10K Turn to Friel | on_course_narrow | 1.5 | 5 | 80 |
| D1 | 10K Turn to Full Turn Blake (Out) | on_course_narrow | 1.5 | 5 | 80 |
| D2 | Full Turn Blake to 10K Turn (Return) | on_course_narrow | 1.5 | 5 | 80 |
| F1 | Friel to Station Rd. | on_course_open | 3.0 | 5 | 80 |
| G1 | Full Loop around QS to Trail/Aberdeen | on_course_open | 3.0 | 5 | 80 |
| H1 | Trail/Aberdeen to/from Station Rd | on_course_narrow | 1.5 | 5 | 80 |
| I1 | Station Rd to Bridge/Mill | on_course_open | 3.0 | 5 | 80 |
| J1 | Bridge/Mill to Half Turn (Outbound) | on_course_narrow | 1.5 | 5 | 80 |
| J2 | Half Turn to Full Turn (Out) | on_course_narrow | 1.5 | 5 | 80 |
| J3 | Full Turn to Half Turn (Return) | on_course_narrow | 1.5 | 5 | 80 |
| J4 | Half Turn to Bridge/Mill | on_course_narrow | 1.5 | 5 | 80 |
| J5 | Half Turn to Bridge/Mill (Slow Half) | on_course_narrow | 1.5 | 5 | 80 |
| K1 | Bridge/Mill to Station Rd | on_course_open | 3.0 | 5 | 80 |
| L1 | Trail/Aberdeen to/from Station Rd | on_course_narrow | 1.5 | 5 | 80 |
| L2 | Station Rd to Trail/Aberdeen | on_course_narrow | 1.5 | 5 | 80 |
| M1 | Trail/Aberdeen to Finish (Full to Loop) | on_course_open | 3.0 | 5 | 80 |
| M2 | Trail/Aberdeen to Finish | on_course_open | 3.0 | 5 | 80 |

---

## Flagged Segments â€” Complete List

| Segment | Label | Worst Bin (km) | Time | Density (p/mÂ²) | Rate (p/s) | Util% | LOS | Severity | Reason |
|----------|--------|----------------|-------|----------------|-------------|--------|------|-----------|---------|
| A1 | A1 | 0.8-1.0 | 07:20 | 0.7550 | N/A | N/A | D | critical | both |
| H1 | H1 | 0.8-1.0 | 07:20 | 0.2980 | N/A | N/A | A | critical | both |
| L1 | L1 | 0.8-1.0 | 07:20 | 0.2990 | N/A | N/A | A | critical | both |
| K1 | K1 | 0.8-1.0 | 07:20 | 0.5760 | N/A | N/A | C | critical | both |
| J5 | J5 | 0.8-1.0 | 07:20 | 0.5780 | N/A | N/A | C | critical | both |
| J4 | J4 | 0.8-1.0 | 07:20 | 0.4810 | N/A | N/A | B | critical | both |
| J1 | J1 | 0.8-1.0 | 07:20 | 0.5780 | N/A | N/A | C | critical | both |
| A2 | A2 | 0.8-1.0 | 07:20 | 0.4690 | N/A | N/A | B | critical | both |
| I1 | I1 | 0.8-1.0 | 07:20 | 1.5850 | N/A | N/A | E | critical | both |
| F1 | F1 | 0.8-1.0 | 07:20 | 1.6340 | N/A | N/A | F | critical | both |
| D2 | D2 | 0.8-1.0 | 07:20 | 0.5110 | N/A | N/A | B | critical | both |
| D1 | D1 | 0.8-1.0 | 07:20 | 0.6650 | N/A | N/A | C | critical | both |
| B3 | B3 | 0.8-1.0 | 07:20 | 0.4060 | N/A | N/A | B | critical | both |
| B2 | B2 | 0.8-1.0 | 07:20 | 0.4060 | N/A | N/A | B | critical | both |
| B1 | B1 | 0.8-1.0 | 07:20 | 0.5260 | N/A | N/A | B | critical | both |
| A3 | A3 | 0.8-1.0 | 07:20 | 0.2910 | N/A | N/A | A | critical | both |
| J2 | J2 | 0.8-1.0 | 07:20 | 0.0380 | N/A | N/A | A | watch | rate_high |
| M1 | M1 | 0.8-1.0 | 07:20 | 0.0850 | N/A | N/A | A | watch | rate_high |

---

## Flagged Bins Summary

| Segment | Label | Flagged | Total | % | Top Reasons |
|----------|--------|----------|--------|----|--------------|
| A1 | A1 | 30 | 400 | 7.5% | both |
| H1 | H1 | 174 | 400 | 43.5% | both |
| L1 | L1 | 185 | 400 | 46.2% | both |
| K1 | K1 | 37 | 400 | 9.2% | both |
| J5 | J5 | 101 | 400 | 25.2% | both |
| J4 | J4 | 104 | 400 | 26.0% | both |
| J1 | J1 | 111 | 400 | 27.8% | both |
| A2 | A2 | 39 | 400 | 9.8% | both |
| I1 | I1 | 81 | 400 | 20.2% | both |
| F1 | F1 | 72 | 400 | 18.0% | both |
| D2 | D2 | 59 | 400 | 14.8% | both |
| D1 | D1 | 54 | 400 | 13.5% | both |
| B3 | B3 | 82 | 400 | 20.5% | both |
| B2 | B2 | 89 | 400 | 22.2% | both |
| B1 | B1 | 73 | 400 | 18.2% | both |
| A3 | A3 | 41 | 400 | 10.2% | both |
| J2 | J2 | 5 | 400 | 1.2% | rate_high |
| M1 | M1 | 5 | 400 | 1.2% | rate_high |

---

## Operational Heatmap

*Operational heatmap visualization will be added in a future release via new maps capability.*

This section will provide:
- Visual density/rate heatmaps across course segments
- Time-based animation of crowd flows
- Interactive bin-level detail views

---

## Segment Details

### Start to Queen/Regent (A1)
- **Type:** start_corral Â· **Width:** 5.0 m Â· **Bins:** 400
- **Active:** 07:00 â†’ 10:00
- **Peaks:** Density 0.7550 p/mÂ² (LOS D), Rate 135.68 p/m/min
- **Worst Bin:** 0.8-1.0 km at 07:20 â€” critical (both)
- **Mitigations:** Implement flow management and density controls

### Queen/Regent to WSB mid-point (A2)
- **Type:** on_course_open Â· **Width:** 5.0 m Â· **Bins:** 400
- **Active:** 07:00 â†’ 10:00
- **Peaks:** Density 0.4690 p/mÂ² (LOS B), Rate 79.35 p/m/min
- **Worst Bin:** 0.8-1.0 km at 07:20 â€” critical (both)
- **Mitigations:** Implement flow management and density controls

### WSB mid-point to Friel (A3)
- **Type:** on_course_open Â· **Width:** 5.0 m Â· **Bins:** 400
- **Active:** 07:00 â†’ 10:00
- **Peaks:** Density 0.2910 p/mÂ² (LOS A), Rate 53.45 p/m/min
- **Worst Bin:** 0.8-1.0 km at 07:20 â€” critical (both)
- **Mitigations:** Implement flow management and density controls

### Friel to 10K Turn (B1)
- **Type:** on_course_narrow Â· **Width:** 1.5 m Â· **Bins:** 400
- **Active:** 07:00 â†’ 10:00
- **Peaks:** Density 0.5260 p/mÂ² (LOS B), Rate 299.50 p/m/min
- **Worst Bin:** 0.8-1.0 km at 07:20 â€” critical (both)
- **Mitigations:** Implement flow management and density controls

### 10K Turn to Friel (B2)
- **Type:** on_course_narrow Â· **Width:** 1.5 m Â· **Bins:** 400
- **Active:** 07:00 â†’ 10:00
- **Peaks:** Density 0.4060 p/mÂ² (LOS B), Rate 228.57 p/m/min
- **Worst Bin:** 0.8-1.0 km at 07:20 â€” critical (both)
- **Mitigations:** Implement flow management and density controls

### 10K Turn to Friel (B3)
- **Type:** on_course_narrow Â· **Width:** 1.5 m Â· **Bins:** 400
- **Active:** 07:00 â†’ 10:00
- **Peaks:** Density 0.4060 p/mÂ² (LOS B), Rate 228.57 p/m/min
- **Worst Bin:** 0.8-1.0 km at 07:20 â€” critical (both)
- **Mitigations:** Implement flow management and density controls

### 10K Turn to Full Turn Blake (Out) (D1)
- **Type:** on_course_narrow Â· **Width:** 1.5 m Â· **Bins:** 400
- **Active:** 07:00 â†’ 10:00
- **Peaks:** Density 0.6650 p/mÂ² (LOS C), Rate 422.06 p/m/min
- **Worst Bin:** 0.8-1.0 km at 07:20 â€” critical (both)
- **Mitigations:** Implement flow management and density controls

### Full Turn Blake to 10K Turn (Return) (D2)
- **Type:** on_course_narrow Â· **Width:** 1.5 m Â· **Bins:** 400
- **Active:** 07:00 â†’ 10:00
- **Peaks:** Density 0.5110 p/mÂ² (LOS B), Rate 316.76 p/m/min
- **Worst Bin:** 0.8-1.0 km at 07:20 â€” critical (both)
- **Mitigations:** Implement flow management and density controls

### Friel to Station Rd. (F1)
- **Type:** on_course_open Â· **Width:** 3.0 m Â· **Bins:** 400
- **Active:** 07:00 â†’ 10:00
- **Peaks:** Density 1.6340 p/mÂ² (LOS F), Rate 472.74 p/m/min
- **Worst Bin:** 0.8-1.0 km at 07:20 â€” critical (both)
- **Mitigations:** Implement flow management and density controls

### Full Loop around QS to Trail/Aberdeen (G1)
- **Type:** on_course_open Â· **Width:** 3.0 m Â· **Bins:** 400
- **Active:** 07:00 â†’ 10:00
- **Peaks:** Density 0.0370 p/mÂ² (LOS A), Rate 11.01 p/m/min
- **Worst Bin:** 0.8-1.0 km at 07:20 â€” none (none)
- **Mitigations:** No mitigations required

### Trail/Aberdeen to/from Station Rd (H1)
- **Type:** on_course_narrow Â· **Width:** 1.5 m Â· **Bins:** 400
- **Active:** 07:00 â†’ 10:00
- **Peaks:** Density 0.2980 p/mÂ² (LOS A), Rate 169.09 p/m/min
- **Worst Bin:** 0.8-1.0 km at 07:20 â€” critical (both)
- **Mitigations:** Implement flow management and density controls

### Station Rd to Bridge/Mill (I1)
- **Type:** on_course_open Â· **Width:** 3.0 m Â· **Bins:** 400
- **Active:** 07:00 â†’ 10:00
- **Peaks:** Density 1.5850 p/mÂ² (LOS E), Rate 462.42 p/m/min
- **Worst Bin:** 0.8-1.0 km at 07:20 â€” critical (both)
- **Mitigations:** Implement flow management and density controls

### Bridge/Mill to Half Turn (Outbound) (J1)
- **Type:** on_course_narrow Â· **Width:** 1.5 m Â· **Bins:** 400
- **Active:** 07:00 â†’ 10:00
- **Peaks:** Density 0.5780 p/mÂ² (LOS C), Rate 350.73 p/m/min
- **Worst Bin:** 0.8-1.0 km at 07:20 â€” critical (both)
- **Mitigations:** Implement flow management and density controls

### Half Turn to Full Turn (Out) (J2)
- **Type:** on_course_narrow Â· **Width:** 1.5 m Â· **Bins:** 400
- **Active:** 07:00 â†’ 10:00
- **Peaks:** Density 0.0380 p/mÂ² (LOS A), Rate 26.46 p/m/min
- **Worst Bin:** 0.8-1.0 km at 07:20 â€” watch (rate_high)
- **Mitigations:** Monitor flow rates, consider temporary holds

### Full Turn to Half Turn (Return) (J3)
- **Type:** on_course_narrow Â· **Width:** 1.5 m Â· **Bins:** 400
- **Active:** 07:00 â†’ 10:00
- **Peaks:** Density 0.0160 p/mÂ² (LOS A), Rate 11.43 p/m/min
- **Worst Bin:** 0.8-1.0 km at 07:20 â€” none (none)
- **Mitigations:** No mitigations required

### Half Turn to Bridge/Mill (J4)
- **Type:** on_course_narrow Â· **Width:** 1.5 m Â· **Bins:** 400
- **Active:** 07:00 â†’ 10:00
- **Peaks:** Density 0.4810 p/mÂ² (LOS B), Rate 288.04 p/m/min
- **Worst Bin:** 0.8-1.0 km at 07:20 â€” critical (both)
- **Mitigations:** Implement flow management and density controls

### Half Turn to Bridge/Mill (Slow Half) (J5)
- **Type:** on_course_narrow Â· **Width:** 1.5 m Â· **Bins:** 400
- **Active:** 07:00 â†’ 10:00
- **Peaks:** Density 0.5780 p/mÂ² (LOS C), Rate 350.73 p/m/min
- **Worst Bin:** 0.8-1.0 km at 07:20 â€” critical (both)
- **Mitigations:** Implement flow management and density controls

### Bridge/Mill to Station Rd (K1)
- **Type:** on_course_open Â· **Width:** 3.0 m Â· **Bins:** 400
- **Active:** 07:00 â†’ 10:00
- **Peaks:** Density 0.5760 p/mÂ² (LOS C), Rate 173.57 p/m/min
- **Worst Bin:** 0.8-1.0 km at 07:20 â€” critical (both)
- **Mitigations:** Implement flow management and density controls

### Trail/Aberdeen to/from Station Rd (L1)
- **Type:** on_course_narrow Â· **Width:** 1.5 m Â· **Bins:** 400
- **Active:** 07:00 â†’ 10:00
- **Peaks:** Density 0.2990 p/mÂ² (LOS A), Rate 169.09 p/m/min
- **Worst Bin:** 0.8-1.0 km at 07:20 â€” critical (both)
- **Mitigations:** Implement flow management and density controls

### Station Rd to Trail/Aberdeen (L2)
- **Type:** on_course_narrow Â· **Width:** 1.5 m Â· **Bins:** 400
- **Active:** 07:00 â†’ 10:00
- **Peaks:** Density 0.0000 p/mÂ² (LOS A), Rate 0.00 p/m/min
- **Worst Bin:** 0.8-1.0 km at 07:20 â€” none (none)
- **Mitigations:** No mitigations required

### Trail/Aberdeen to Finish (Full to Loop) (M1)
- **Type:** on_course_open Â· **Width:** 3.0 m Â· **Bins:** 400
- **Active:** 07:00 â†’ 10:00
- **Peaks:** Density 0.0850 p/mÂ² (LOS A), Rate 23.89 p/m/min
- **Worst Bin:** 0.8-1.0 km at 07:20 â€” watch (rate_high)
- **Mitigations:** Monitor flow rates, consider temporary holds

### Trail/Aberdeen to Finish (M2)
- **Type:** on_course_open Â· **Width:** 3.0 m Â· **Bins:** 400
- **Active:** 07:00 â†’ 10:00
- **Peaks:** Density 0.0000 p/mÂ² (LOS A), Rate 0.00 p/m/min
- **Worst Bin:** 0.8-1.0 km at 07:20 â€” none (none)
- **Mitigations:** No mitigations required

---

## Mitigations

- **High Density + High Rate:** Implement flow management and density controls
- **High Throughput Rate:** Monitor flow rates, consider temporary holds

---

## Appendix

### Definitions of Metrics
- **Density (Ï):** Areal density in persons per square meter (p/mÂ²)
- **Rate (q):** Throughput rate in persons per second (p/s)
- **Rate per meter per minute:** (rate / width_m) Ã— 60 in persons/m/min
- **LOS (Level of Service):** Crowd comfort class (Aâ€“F)
- **Bin:** Spaceâ€“time cell [segment_id, start_kmâ€“end_km, t_startâ€“t_end]

### LOS Thresholds
| LOS | Density Range (p/mÂ²) | Description |
|-----|---------------------|-------------|
| A | 0.00 - 0.36 | Free Flow |
| B | 0.36 - 0.54 | Comfortable |
| C | 0.54 - 0.72 | Moderate |
| D | 0.72 - 1.08 | Dense |
| E | 1.08 - 1.63 | Very Dense |
| F | 1.63+ | Extremely Dense |

### Trigger Logic & Severity
- **los_high:** Density â‰¥ LOS C threshold
- **rate_high:** Rate per m per min â‰¥ warning threshold
- **both:** Both density and rate conditions met
- **Severity:** critical > watch > none

### Terminology Notes
- "Rate" = persons/s (formerly "Flow")
- Note: operational heatmap to be added in future release