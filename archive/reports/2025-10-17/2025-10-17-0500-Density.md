# Fredericton Marathon — Density Report
**Schema:** 1.0.0
**Method:** segments_from_bins
**Date:** 2025-10-17 05:00:43
**Inputs:** bins.parquet, segments.parquet, segment_windows_from_bins.parquet
**App:** v1.6.42

---

## Executive Summary
- **Peak Density:** 0.7550 p/m² (LOS D)
- **Peak Rate:** 2.26 p/s
- **Segments with Flags:** 1 / 22
- **Flagged Bins:** 1 / 19440
- **Operational Status:** ⚠️ Attention Required (Watch conditions detected)

> LOS (Level of Service) describes how comfortable runners are within a section — A means free-flowing, while E/F indicate crowding. Even when overall LOS is good, short-lived surges in runner flow can stress aid stations or intersections, requiring active flow management.

---

## Methodology & Inputs
- **Window Size:** 30 s; **Bin Size:** 0.2 km

### LOS and Rate Triggers (from Rulebook)
- **LOS thresholds** define crowding levels based on density (p/m²):
  - A: < 0.36 | B: 0.36–0.54 | C: 0.54–0.72 | D: 0.72–1.08 | E: 1.08–1.63 | F: > 1.63
- **Rate thresholds** define throughput risk based on flow references (persons/m/min):
  - Warning: 17.2 | Critical: 24.1

These thresholds come from the Fredericton Marathon rulebook and align with crowd management standards for mass participation events.

---

## Start Times & Cohorts
- **Full Marathon** — 07:00 (368 runners)
- **10K** — 07:20 (618 runners)
- **Half Marathon** — 07:40 (912 runners)

> Bins may include runners from multiple events as waves overlap in time.

---

## Course Overview

| Segment | Label | Schema | Width (m) | Spatial Bins |
|----------|--------|--------|-----------|--------------|
| A1 | Start to Queen/Regent | start_corral | 5.0 | 5 |
| A2 | Queen/Regent to WSB mid-point | on_course_open | 5.0 | 5 |
| A3 | WSB mid-point to Friel | on_course_open | 5.0 | 5 |
| B1 | Friel to 10K Turn | on_course_narrow | 1.5 | 8 |
| B2 | 10K Turn to Friel | on_course_narrow | 1.5 | 8 |
| B3 | 10K Turn to Friel | on_course_narrow | 1.5 | 8 |
| D1 | 10K Turn to Full Turn Blake (Out) | on_course_narrow | 1.5 | 27 |
| D2 | Full Turn Blake to 10K Turn (Return) | on_course_narrow | 1.5 | 27 |
| F1 | Friel to Station Rd. | on_course_open | 3.0 | 12 |
| G1 | Full Loop around QS to Trail/Aberdeen | on_course_open | 3.0 | 6 |
| H1 | Trail/Aberdeen to/from Station Rd | on_course_narrow | 1.5 | 9 |
| I1 | Station Rd to Bridge/Mill | on_course_open | 3.0 | 29 |
| J1 | Bridge/Mill to Half Turn (Outbound) | on_course_narrow | 1.5 | 14 |
| J2 | Half Turn to Full Turn (Out) | on_course_narrow | 1.5 | 8 |
| J3 | Full Turn to Half Turn (Return) | on_course_narrow | 1.5 | 7 |
| J4 | Half Turn to Bridge/Mill | on_course_narrow | 1.5 | 13 |
| J5 | Half Turn to Bridge/Mill (Slow Half) | on_course_narrow | 1.5 | 14 |
| K1 | Bridge/Mill to Station Rd | on_course_open | 3.0 | 18 |
| L1 | Trail/Aberdeen to/from Station Rd | on_course_narrow | 1.5 | 9 |
| L2 | Station Rd to Trail/Aberdeen | on_course_narrow | 1.5 | 7 |
| M1 | Trail/Aberdeen to Finish (Full to Loop) | on_course_open | 3.0 | 2 |
| M2 | Trail/Aberdeen to Finish | on_course_open | 3.0 | 2 |

> Note: Each spatial bin is analyzed across 80 time windows (30-second intervals). Total space-time bins per segment = spatial bins × 80 (e.g., A1: 5 × 80 = 400; I1: 121 × 80 = 9,680).

---

## Flagged Segments

| Segment | Label | Flagged Bins | Total Bins | % | Worst Bin (km) | Time | Density (p/m²) | Rate (p/s) | Util% | LOS | Severity | Reason |
|----------|--------|--------------|------------|---|----------------|-------|----------------|-------------|-------|-----|-----------|---------|
| B1 | Friel to 10K Turn | 1 | 640 | 0.2% | 0.0-0.2 | 07:36 | 0.7200 | 3.047 | 30% | D | watch | density |

---

## Operational Heatmap

*Operational heatmap visualization will be added in a future release via new maps capability.*

This section will provide:
- Visual density/rate heatmaps across course segments
- Time-based animation of crowd flows
- Interactive bin-level detail views

---

## Bin-Level Detail

Detailed bin-by-bin breakdown for segments with operational intelligence flags:

### Friel to 10K Turn (B1)

| Start (km) | End (km) | Start (t) | End (t) | Density (p/m²) | Rate (p/s) | LOS |
|------------|----------|-----------|---------|----------------|-------------|-----|
| 0.0 | 0.2 | 07:36 | 07:38 | 0.720 | 3.047 | D |

---

## Segment Details

### Start to Queen/Regent (A1)
- **Schema:** start_corral · **Width:** 5.0 m · **Bins:** 400
- **Active:** 07:00 → 10:00
- **Peaks:** Density 0.7550 p/m² (LOS B), Rate 2.26 p/s, Util 23%
- **Worst Bin:** 0.0-0.0 km at N/A — none (none)
- **Mitigations:** No mitigations required

### Queen/Regent to WSB mid-point (A2)
- **Schema:** on_course_open · **Width:** 5.0 m · **Bins:** 400
- **Active:** 07:00 → 10:00
- **Peaks:** Density 0.4690 p/m² (LOS B), Rate 1.32 p/s
- **Worst Bin:** 0.0-0.0 km at N/A — none (none)
- **Mitigations:** No mitigations required

### WSB mid-point to Friel (A3)
- **Schema:** on_course_open · **Width:** 5.0 m · **Bins:** 400
- **Active:** 07:00 → 10:00
- **Peaks:** Density 0.2910 p/m² (LOS A), Rate 0.89 p/s
- **Worst Bin:** 0.0-0.0 km at N/A — none (none)
- **Mitigations:** No mitigations required

### Friel to 10K Turn (B1)
- **Schema:** on_course_narrow · **Width:** 1.5 m · **Bins:** 640
- **Active:** 07:00 → 10:00
- **Peaks:** Density 0.7200 p/m² (LOS D), Rate 2.03 p/s, Util 30%
- **Worst Bin:** 0.0-0.2 km at 07:36 — watch (density)
- **Mitigations:** Deploy lateral barriers and regulate inflow

### 10K Turn to Friel (B2)
- **Schema:** on_course_narrow · **Width:** 1.5 m · **Bins:** 640
- **Active:** 07:00 → 10:00
- **Peaks:** Density 0.4833 p/m² (LOS B), Rate 1.38 p/s, Util 21%
- **Worst Bin:** 0.0-0.0 km at N/A — none (none)
- **Mitigations:** No mitigations required

### 10K Turn to Friel (B3)
- **Schema:** on_course_narrow · **Width:** 1.5 m · **Bins:** 640
- **Active:** 07:00 → 10:00
- **Peaks:** Density 0.4833 p/m² (LOS B), Rate 1.38 p/s, Util 21%
- **Worst Bin:** 0.0-0.0 km at N/A — none (none)
- **Mitigations:** No mitigations required

### 10K Turn to Full Turn Blake (Out) (D1)
- **Schema:** on_course_narrow · **Width:** 1.5 m · **Bins:** 2160
- **Active:** 07:00 → 10:00
- **Peaks:** Density 0.2333 p/m² (LOS A), Rate 0.79 p/s, Util 12%
- **Worst Bin:** 0.0-0.0 km at N/A — none (none)
- **Mitigations:** No mitigations required

### Full Turn Blake to 10K Turn (Return) (D2)
- **Schema:** on_course_narrow · **Width:** 1.5 m · **Bins:** 2160
- **Active:** 07:00 → 10:00
- **Peaks:** Density 0.1433 p/m² (LOS A), Rate 0.47 p/s, Util 7%
- **Worst Bin:** 0.0-0.0 km at N/A — none (none)
- **Mitigations:** No mitigations required

### Friel to Station Rd. (F1)
- **Schema:** on_course_open · **Width:** 3.0 m · **Bins:** 960
- **Active:** 07:00 → 10:00
- **Peaks:** Density 0.5600 p/m² (LOS C), Rate 1.66 p/s
- **Worst Bin:** 0.0-0.0 km at N/A — none (none)
- **Mitigations:** No mitigations required

### Full Loop around QS to Trail/Aberdeen (G1)
- **Schema:** on_course_open · **Width:** 3.0 m · **Bins:** 480
- **Active:** 07:00 → 10:00
- **Peaks:** Density 0.0417 p/m² (LOS A), Rate 0.12 p/s
- **Worst Bin:** 0.0-0.0 km at N/A — none (none)
- **Mitigations:** No mitigations required

### Trail/Aberdeen to/from Station Rd (H1)
- **Schema:** on_course_narrow · **Width:** 1.5 m · **Bins:** 720
- **Active:** 07:00 → 10:00
- **Peaks:** Density 0.3267 p/m² (LOS A), Rate 0.92 p/s, Util 14%
- **Worst Bin:** 0.0-0.0 km at N/A — none (none)
- **Mitigations:** No mitigations required

### Station Rd to Bridge/Mill (I1)
- **Schema:** on_course_open · **Width:** 3.0 m · **Bins:** 2320
- **Active:** 07:00 → 10:00
- **Peaks:** Density 0.2667 p/m² (LOS A), Rate 0.78 p/s
- **Worst Bin:** 0.0-0.0 km at N/A — none (none)
- **Mitigations:** No mitigations required

### Bridge/Mill to Half Turn (Outbound) (J1)
- **Schema:** on_course_narrow · **Width:** 1.5 m · **Bins:** 1120
- **Active:** 07:00 → 10:00
- **Peaks:** Density 0.2667 p/m² (LOS A), Rate 0.81 p/s, Util 12%
- **Worst Bin:** 0.0-0.0 km at N/A — none (none)
- **Mitigations:** No mitigations required

### Half Turn to Full Turn (Out) (J2)
- **Schema:** on_course_narrow · **Width:** 1.5 m · **Bins:** 640
- **Active:** 07:00 → 10:00
- **Peaks:** Density 0.0500 p/m² (LOS A), Rate 0.17 p/s, Util 3%
- **Worst Bin:** 0.0-0.0 km at N/A — none (none)
- **Mitigations:** No mitigations required

### Full Turn to Half Turn (Return) (J3)
- **Schema:** on_course_narrow · **Width:** 1.5 m · **Bins:** 560
- **Active:** 07:00 → 10:00
- **Peaks:** Density 0.0400 p/m² (LOS A), Rate 0.14 p/s, Util 2%
- **Worst Bin:** 0.0-0.0 km at N/A — none (none)
- **Mitigations:** No mitigations required

### Half Turn to Bridge/Mill (J4)
- **Schema:** on_course_narrow · **Width:** 1.5 m · **Bins:** 1040
- **Active:** 07:00 → 10:00
- **Peaks:** Density 0.2233 p/m² (LOS A), Rate 0.66 p/s, Util 10%
- **Worst Bin:** 0.0-0.0 km at N/A — none (none)
- **Mitigations:** No mitigations required

### Half Turn to Bridge/Mill (Slow Half) (J5)
- **Schema:** on_course_narrow · **Width:** 1.5 m · **Bins:** 1120
- **Active:** 07:00 → 10:00
- **Peaks:** Density 0.2667 p/m² (LOS A), Rate 0.81 p/s, Util 12%
- **Worst Bin:** 0.0-0.0 km at N/A — none (none)
- **Mitigations:** No mitigations required

### Bridge/Mill to Station Rd (K1)
- **Schema:** on_course_open · **Width:** 3.0 m · **Bins:** 1440
- **Active:** 07:00 → 10:00
- **Peaks:** Density 0.1017 p/m² (LOS A), Rate 0.30 p/s
- **Worst Bin:** 0.0-0.0 km at N/A — none (none)
- **Mitigations:** No mitigations required

### Trail/Aberdeen to/from Station Rd (L1)
- **Schema:** on_course_narrow · **Width:** 1.5 m · **Bins:** 720
- **Active:** 07:00 → 10:00
- **Peaks:** Density 0.3267 p/m² (LOS A), Rate 0.92 p/s, Util 14%
- **Worst Bin:** 0.0-0.0 km at N/A — none (none)
- **Mitigations:** No mitigations required

### Station Rd to Trail/Aberdeen (L2)
- **Schema:** on_course_narrow · **Width:** 1.5 m · **Bins:** 560
- **Active:** 07:00 → 10:00
- **Peaks:** Density 0.0000 p/m² (LOS A), Rate 0.00 p/s
- **Worst Bin:** 0.0-0.0 km at N/A — none (none)
- **Mitigations:** No mitigations required

### Trail/Aberdeen to Finish (Full to Loop) (M1)
- **Schema:** on_course_open · **Width:** 3.0 m · **Bins:** 160
- **Active:** 07:00 → 10:00
- **Peaks:** Density 0.1417 p/m² (LOS A), Rate 0.40 p/s
- **Worst Bin:** 0.0-0.0 km at N/A — none (none)
- **Mitigations:** No mitigations required

### Trail/Aberdeen to Finish (M2)
- **Schema:** on_course_open · **Width:** 3.0 m · **Bins:** 160
- **Active:** 07:00 → 10:00
- **Peaks:** Density 0.0000 p/m² (LOS A), Rate 0.00 p/s
- **Worst Bin:** 0.0-0.0 km at N/A — none (none)
- **Mitigations:** No mitigations required

---

## Mitigations


---

## Appendix

### Definitions of Metrics
- **Density (ρ):** Areal density in persons per square meter (p/m²)
- **Rate (q):** Throughput rate in persons per second (p/s)
- **Rate per meter per minute:** (rate / width_m) × 60 in persons/m/min
- **Utilization (%):** Current flow rate / reference flow rate (critical)
- **LOS (Level of Service):** Crowd comfort class (A–F)
- **Bin:** Space–time cell [segment_id, start_km–end_km, t_start–t_end]

### LOS Thresholds
| LOS | Density Range (p/m²) | Description |
|-----|---------------------|-------------|
| A | 0.00 - 0.36 | Free Flow |
| B | 0.36 - 0.54 | Comfortable |
| C | 0.54 - 0.72 | Moderate |
| D | 0.72 - 1.08 | Dense |
| E | 1.08 - 1.63 | Very Dense |
| F | 1.63+ | Extremely Dense |

### Trigger Logic & Severity
- **los_high:** Density ≥ LOS C threshold
- **rate_high:** Rate per m per min ≥ warning threshold
- **both:** Both density and rate conditions met
- **Severity:** critical > watch > none

### Terminology Notes
- "Rate" = persons/s (formerly "Flow")
- Note: operational heatmap to be added in future release