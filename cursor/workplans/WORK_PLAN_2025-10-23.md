# 🏁 Sydney Milestone Workplan

**Milestone:** Sydney (#14)  
**Due Date:** October 25, 2025  
**Status:** 67% complete (4/6 issues complete)  
**Objective:** Deliver the **Race-Crew Web UI** (Epic #279) with unified Cloud Run behavior, interactive visualization, and stable developer pipelines.

**Progress Update:** Phase 1 complete (Issue #319). Ready to start Phase 2 frontend features.

## 📈 Summary Table

| Order | Issue                      | Category | Effort | Priority | Status         |
| :---: | :------------------------- | :------- | :----- | :------- | :------------- |
|   1   | #319 Enable Bin Dataset    | Bug Fix  | XS     | P0       | ✅ Complete    |
|   2   | #314 Password Gate         | Feature  | M      | P1       | 🟢 Ready       |
|   3   | #317 Segments Map          | Feature  | M      | P1       | 🟢 Ready       |
|   4   | #280 Density Heatmaps      | Feature  | M      | P1       | 🟢 Ready       |
|   5   | #318 Bin-Level Table       | Feature  | S      | P1       | 🟢 Ready       |
|   6   | #279 Epic Integration      | Meta     | M-L    | P2       | 🟠 Pending     |
|   -   | #321 Runner Orchestration  | DX       | L      | P2       | 🔵 Future Work |
|   -   | #296 CI Noise Reduction    | DX       | S      | P2       | 🔴 Superseded  |
|   -   | #315 Cloud Report v2 Fix   | Cleanup  | M      | P2       | 🔴 Deferred    |

---

## 🔹 Phase 1 — Quick Wins & Stabilization

*Immediate, low-risk items that unblock Cloud parity and CI efficiency.*

### ✅ 1. #319 – Enable Bin Dataset by Default (Quick Fix) - COMPLETE

* **Goal:** Flip `enable_bin_dataset` flag from `False` to `True` in `density_report.py`.
* **Status:** ✅ **COMPLETED** (Oct 23, 2025)
* **Implementation:**
  * Changed default flag value in `main.py` and `density_report.py`
  * Commented out legacy report generation (eliminated duplicate 15KB reports)
  * Added confirmation logging
* **Commits:** `eb6f6a9`, `8380867`
* **Effort:** XS (30 minutes as estimated)
* **Validation:** 
  * ✅ Local E2E: 6/6 passed, single v2 report
  * ✅ Cloud E2E: 6/6 passed (CI run 18747667787)
  * ✅ Production: Single 109KB v2 report in GCS
* **Outcome:** All Cloud and local runs now generate consistent v2 reports with bin-level details. No duplicate legacy reports.

**Note:** Issue #315 (API import restructuring) deferred to post-Sydney for code cleanup.

### 🔵 2. #321 – Runner Orchestration Layer - NOT IN SCOPE

* **Goal:** Unified `Runner` layer to replace fragmented YAML-based CI orchestration.
* **Status:** 🔵 **FUTURE WORK** (post-Sydney)
* **Rationale:** 
  * More comprehensive solution than #296
  * Requires architectural changes to CI/CD pipelines
  * Better suited for post-Sydney technical debt sprint
  * Supersedes #296 with broader scope (entire workflow orchestration)
* **Effort:** L (3-5 days)
* **Priority:** P2 (important but not blocking Sydney milestone)

**Note:** Issue #296 (CI Noise Reduction) superseded by broader #321 approach.

---

## 🔹 Phase 2 — Core Epic Features ( #279 : Race-Crew Web UI )

*All remaining front-end & auth components built against the new StorageService backend.*

### 🔐 3. #314 – Password Gate with Session Management ( 279-1 )

* **Goal:** Implement auth middleware for Race-Crew dashboard.
* **Tasks:**

  * Use FastAPI SessionMiddleware + signed cookie.
  * Add simple login form (front-end).
* **Effort:** M (1 day)
* **Dependency:** None.
* **Outcome:** Dashboard secured behind login gate.

### 🗺️ 4. #317 – Implement Segments Map (Leaflet visualization) ( 279-2 )

* **Goal:** Render segments.geojson from StorageService onto Leaflet map.
* **Tasks:**

  * Use `StorageService.read_geojson()`.
  * Integrate interactive hover tooltips + filter controls.
* **Effort:** M (1 day)
* **Dependency:** Optional #314 (auth).
* **Outcome:** Interactive map for segment visualization.

### 🔥 5. #280 – Density Heatmaps Visualization ( 279-3 )

* **Goal:** Generate and display density heatmaps from `bins.parquet`.
* **Tasks:**

  * Use `StorageService.read_parquet()`.
  * Render static PNG heatmaps or interactive canvas overlay.
* **Effort:** M (1–2 days).
* **Dependency:** Storage migration (#298) ✅.
* **Outcome:** Heatmap view with consistent Cloud data.

### 📊 6. #318 – Implement Bin-Level Details Table ( 279-4 )

* **Goal:** Tabular details per segment bin (utilization, flags, metrics).
* **Tasks:**

  * Reuse existing Density API response.
  * Display sortable table in UI.
* **Effort:** S (½ day).
* **Dependency:** #280.
* **Outcome:** Detailed table complementing heatmap visualization.

---

## 🔹 Phase 3 — Integration & QA ( #279 )

*Final integration of Race-Crew UI and Cloud verification.*

### 🧩 7. #279 – Epic Integration and Polish

* **Goal:** Integrate auth, map, heatmap, and table modules into final Race-Crew UI.
* **Tasks:**

  * Merge and test all features locally and in Cloud Run.
  * Verify data flow and route auth.
  * Resolve UI styling issues.
* **Effort:** M–L (1–2 days).
* **Outcome:** Stable, interactive Race-Crew Web UI release.

---

## ⚙️ Execution Guidelines for Cursor

* **Branching:** Create per-issue branches (e.g. `feat/314-password-gate`, `feat/317-segments-map`).
* **Order:** Work strictly top-to-bottom unless blocked.
* **After Each PR:**

  * Comment in GitHub issue: "✅ Verified in Cloud Run."
  * Close issue on merge.
* **Testing:** Prefer Cloud Run validation for all Phase 2 features and #279 epic.
* **Parallelization:** #317 and #280 may run concurrently after #314 completes.

---

## 📝 Notes

**Created:** October 23, 2025  
**Updated:** October 23, 2025 - 13:00 EDT (Issue #319 complete, #321 replaces #296)  
**Source:** ChatGPT (Senior Technical Architect role)  
**Context:** Post-GitHub issue review session  
**Active Issues:** Epic #279, Issues #280, #314, #317, #318  
**Completed Issues:** #319 (bin dataset enabled)  
**Deferred Issues:** #315 (API restructuring), #296 (superseded by #321), #321 (runner orchestration - post-Sydney)

---

## 🎯 Success Criteria

**Phase 1 Complete:** ✅ **ACHIEVED** (Oct 23, 2025)
- ✅ Cloud Run generates v2 density reports (Issue #319)
- ✅ Single report per run (no legacy duplicates)
- ✅ Cloud/local parity established
- ⏭️ CI workflow optimization deferred to #321 (post-Sydney)

**Phase 2 Complete:** (Target: Oct 24-25)
- [ ] Auth gate protects dashboard (#314)
- [ ] Interactive segments map live (#317)
- [ ] Density heatmaps visible (#280)
- [ ] Bin-level details table functional (#318)

**Phase 3 Complete:** (Target: Oct 25)
- [ ] All features integrated and tested
- [ ] Cloud Run validation passing
- [ ] Epic #279 closed
- [ ] Sydney milestone 100% complete

---

## ⚠️ Risk Mitigation

**Blocker Risks:**
1. ~~**#319 (P0)**~~ - ✅ RESOLVED (Cloud parity achieved)
2. **Storage Service** - ✅ Already migrated (#298), reduces integration risk
3. **Auth Implementation** - May require session storage strategy decision
4. **Frontend Dependencies** - Leaflet, session management need evaluation

**Mitigation Strategies:**
- ✅ P0 blockers resolved (Phase 1 complete)
- Parallelize independent features (#317, #280)
- Maintain clean branch strategy for easy rollbacks
- Test in Cloud Run after each merge
- Start with #314 (auth foundation) before dependent features

---

## 🔄 Progress Tracking

Update this section as work completes:

- [x] **Phase 1: Quick Wins** - ✅ COMPLETE (Oct 23, 13:00)
  - [x] #319 - Enable Bin Dataset by Default ✅
  - [ ] #296/321 - Deferred (not in Sydney scope)
- [ ] **Phase 2: Core Features** (Items 2-5) - 🟢 Ready to Start
  - [ ] #314 - Password Gate
  - [ ] #317 - Segments Map
  - [ ] #280 - Density Heatmaps
  - [ ] #318 - Bin-Level Table
- [ ] **Phase 3: Integration** (Item 6)
  - [ ] #279 - Epic Integration

**Last Updated:** October 23, 2025 - 13:00 EDT

---

## 📋 Strategic Changes Log

### Issue #319 Completion (Oct 23, 13:00)

**Status:** ✅ **COMPLETE AND VALIDATED**

**Implementation:**
- Commit 1 (`eb6f6a9`): Changed `enable_bin_dataset` default from `False` to `True`
- Commit 2 (`8380867`): Commented out legacy report generation to eliminate duplicates

**Results:**
- ✅ Cloud and local generate identical v2 Density reports
- ✅ Single 109KB report per run (no 15KB legacy duplicate)
- ✅ ~30 seconds faster processing
- ✅ 50% reduction in GCS storage per run
- ✅ Validated in production (GCS report `2025-10-23-1207-Density.md`)

**Phase 1 Status:** ✅ COMPLETE (all P0 blockers resolved)

---

### Issue #296 → #321 Replacement (Oct 23, 13:00)

**Decision:** Replace #296 (CI Noise Reduction) with broader #321 (Runner Orchestration Layer).

**Original Scope (#296):**
- Consolidate build + test workflows
- Add draft PR detection
- Disable redundant checks
- Effort: 1-2 hours
- Scope: Limited to GitHub Actions noise reduction

**New Scope (#321):**
- Unified Runner orchestration layer (`python -m app.runner.run <bundle>`)
- Dependency-aware task execution (DAG-based)
- Single entrypoint for density, flow, and combined runs
- State tracking with `.runstate/{run_id}.json`
- Effort: 3-5 days
- Scope: Complete workflow orchestration framework

**Why Deferred:**
- #321 is more comprehensive (addresses root cause, not symptoms)
- Requires architectural changes across CI/CD
- Better suited for post-Sydney technical debt sprint
- Not blocking Sydney milestone delivery

**Status:** #296 marked as superseded, #321 deferred to future milestone.

---

### Issue #315 → #319 Swap (Oct 23, 08:00)

**Decision:** After architectural review with ChatGPT, replaced #315 with simpler #319.

**Original Plan (#315):**
- Update `main.py` imports to use `new_density_report.py`
- Add compatibility wrappers
- Restructure API routing
- Effort: 1 hour
- Risk: Low but requires testing multiple code paths

**New Plan (#319):**
- Flip `enable_bin_dataset` default flag from `False` to `True`
- Comment out legacy report generation
- Effort: 30 minutes
- Risk: Very low (artifacts already exist per #298)

**Why Better:**
- 50% faster implementation
- Same user-facing outcome
- Bin artifacts already generated in all environments
- Resource constraints resolved in Oct 2025 refactor
- #315 remains open for future API cleanup work

**Outcome:** ✅ Completed as described above.

**Last Updated:** October 23, 2025 - 13:00 EDT

