# ğŸ“ Handover Note: A2/A3 Discrepancies in E2E Testing

## âœ… Context
- The **M1/F1 algorithm consistency milestone is complete** â€” both Main Analysis and Flow Runner now produce identical results.
- End-to-end testing passed, except for **A2 and A3 segments**, where reported overtakes differ significantly from expected results.

## ğŸ” Findings
- **Expected results** (from `flow_expected_results.csv`):
  - A2 Half vs 10K â†’ `1/1`
  - A3 Half vs 10K â†’ `13/1`
- **Actual results** (from E2E run):
  - A2 Half vs 10K â†’ `34/5`
  - A3 Half vs 10K â†’ `128/10`

### Why this is different from M1/F1
- M1/F1 issues were about **consistency** (strict vs raw passes, selector thresholds).  
- A2/A3 discrepancies are **order-of-magnitude** differences, suggesting:
  1. **Segment boundary mismatch** â†’ Start/stop definitions for A2/A3 may have changed between `segments_new.csv` and the expectations file.  
  2. **Input normalization gap** â†’ EPS snapping at 100m/600s may not be applied consistently in these segments.  
  3. **Expected file staleness** â†’ `flow_expected_results.csv` may not have been regenerated after recent 2025 course/segment updates.

## ğŸ“‹ Recommended Next Steps
1. **Check A2/A3 segment definitions**
   - Compare `segments_new.csv` with what was originally used to generate `flow_expected_results.csv`.
   - Confirm if course or boundary updates were made (kick-off decks in Jan/Feb 2025 confirm course adjustments).

2. **Confirm input normalization**
   - Ensure EPS snapping (100m spatial, 600s temporal) is applied consistently for A2/A3, just as it is for M1/F1.

3. **Regenerate expected results**
   - If segment definitions or overlap calculations changed, regenerate A2/A3 ground truth from Main Analysis and update `flow_expected_results.csv` accordingly.

## ğŸš€ Bottom Line
- **Algorithm is consistent**: Both systems behave identically across all segments.  
- **A2/A3 are content-quality issues**: Expected results are likely out of sync with updated course definitions or input handling.  
- **Action**: Refresh expected results for A2/A3 to match current segment definitions and Main Analysis output.

---

âœ”ï¸ **No algorithm bug remains.**  
The only remaining task is **data hygiene** â€” aligning expected results with current definitions.
